# 🎮 RetroDecode Web Visualizer - 使い方ガイド

## 🚀 クイックスタート

### ローカル開発

```bash
cd web
npm install
npm run dev
# → http://localhost:5173 でアクセス
```

### プロダクションビルド

```bash
cd web
npm run build
# → web/dist/ に静的ファイルが生成されます
```

---

## 📖 使い方

### 1. **モックデータで試す**

アプリを起動すると、自動的に50ステップのモックデータが読み込まれます。
- スライダーを動かして各ステップを確認
- 再生ボタンで自動再生
- 速度調整で学習ペースを変更

### 2. **実際のLF2ファイルを読み込む**

1. **ファイル選択**
   - 「📂 LF2/PDTファイルを開く」ボタンをクリック
   - 手元の `.lf2` ファイルを選択

2. **自動解析**
   - ヘッダー情報を解析（幅・高さ・パレット）
   - LZSS圧縮データを段階的に展開
   - 各ステップを可視化データとして生成

3. **ステップバイステップ表示**
   - **圧縮データパネル**: 現在処理中のバイトをハイライト
   - **リングバッファパネル**: ヒートマップで状態を可視化
   - **出力画像パネル**: 段階的に描画される画像
   - **解説パネル**: 各ステップの詳細説明（日本語）

---

## 🎬 操作方法

### 再生コントロール

| ボタン | 機能 |
|--------|------|
| ⏪ | 10ステップ巻き戻し |
| ◀ | 1ステップ戻る |
| ▶ / ⏸ | 再生 / 一時停止 |
| ▶ | 1ステップ進む |
| ⏩ | 10ステップ早送り |

### スライダー

- **ステップスライダー**: ドラッグで任意のステップに移動
- **速度スライダー**: 0.25x〜4x の範囲で再生速度を調整

---

## 📊 表示される情報

### フラグバイト（🚩）
```
フラグバイト 0xFF を読み込みました。
このバイトの各ビットが次の8つの操作を制御します。
ビット=1: 直接ピクセル（リテラル）
ビット=0: LZSSマッチ（リングバッファ参照）
```

### 直接ピクセル（📝）
```
直接ピクセルデータ: パレットインデックス 143 (0x8F)
座標: (0, 0) → 出力位置 76479
リングバッファ位置 0xFEE に書き込み
この操作では圧縮されていない生のピクセル値を直接出力します。
```

### LZSSマッチ（🔄）
```
LZSSマッチング（LZSS Match）
生バイト: [0x0F, 0xFE]
→ 長さ: 3 バイト (0x0 + 3)
→ 位置: 0xFEF
→ 距離: 15 バイト前

リングバッファの位置 0xFEF から 3 バイトをコピーします。
これにより 3バイトを2バイトで表現できます（圧縮率: 33.3%）。
```

---

## 🎯 教育的ポイント

### LZSS圧縮アルゴリズムの理解

1. **リングバッファの役割**
   - 過去4KB（0x1000バイト）のデータを保持
   - 繰り返しパターンを効率的に参照

2. **圧縮の仕組み**
   - **直接ピクセル**: 1バイト → 1バイト（圧縮なし）
   - **LZSSマッチ**: 3〜18バイト → 2バイト（圧縮率最大89%）

3. **フラグバイトによる制御**
   - 8つの操作をまとめて制御
   - ビット単位でリテラル/マッチを指定

---

## 🔧 技術仕様

### 対応フォーマット
- ✅ **LF2** (ToHeart LEAF256)
  - ヘッダー: 24バイト
  - パレット: BGRフォーマット（最大256色）
  - 圧縮: LZSS + XOR暗号化

- 🚧 **PDT** (Kanon) - 近日対応予定

### パフォーマンス
- **最大ステップ数**: 500ステップ（大きいファイルは自動制限）
- **処理速度**: ブラウザ内で即座に解析
- **メモリ使用量**: 数MB程度

---

## 🐛 トラブルシューティング

### ファイルが読み込めない

**問題**: 「ファイルの解析に失敗しました」エラー

**原因と対策**:
1. **マジックナンバー不一致**
   - LF2ファイルは `LEAF256\0` で始まる必要があります
   - ファイルが破損していないか確認

2. **未対応フォーマット**
   - 現在はLF2のみ対応
   - PDTは実装中

### 画像が正しく表示されない

**問題**: 画像が乱れる、色がおかしい

**原因と対策**:
1. **パレット情報の欠損**
   - ファイルに正しいパレットが含まれているか確認

2. **Y軸反転**
   - LF2は下から上に描画（自動対応済み）

---

## 🚀 次のステップ

### 予定している機能

- [ ] **エンコード過程の可視化**
  - RGB画像 → LF2への変換過程を表示

- [ ] **比較モード**
  - オリジナル vs 再圧縮の並列表示
  - Diff検出とハイライト

- [ ] **パフォーマンスグラフ**
  - リアルタイム圧縮率表示
  - メモリ使用量の可視化

- [ ] **WASM統合**
  - Rustバックエンドとの統合
  - より高速な処理

---

## 📚 参考資料

- [CLAUDE.md](../CLAUDE.md) - プロジェクト全体の概要
- [ultimate-achievement-2025-07-07.md](../docs/ultimate-achievement-2025-07-07.md) - 歴史的達成記録
- [TECHNICAL_INSIGHTS.md](../.claude/TECHNICAL_INSIGHTS.md) - 技術詳細

---

**P⁴ — Pixel by pixel, past preserved**

*1990年代の圧縮技術を現代のブラウザで体験*
