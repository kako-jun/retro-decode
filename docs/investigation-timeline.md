# LF2エンコーダ完全復元調査記録
## 〜機械学習による失われた技術の発掘〜

### 📊 調査概要
- **目標**: 20年前のToHeart開発者が使用した完璧なLZSS設定値の特定
- **手法**: 逆エンジニアリング + 機械学習 + 的を絞った総当たり検索
- **データ**: 522個のLF2ファイル、246万決定ポイント、447,685パラメータNN

---

## 🕵️ 調査の軌跡

### フェーズ1: 問題発見 (初期状態)
```
❌ 問題: 往復テストで128→20ピクセル差異
❌ 圧縮: 516%サイズ (5.2倍肥大化)
❓ 謎: 圧縮レベルに関係なく100%精度でないのはおかしい
```

### フェーズ2: 根本原因特定
```
🔍 深層解析実行 → 衝撃の発見
💥 オリジナル21KB vs 我々67KB (311.7%!)
💥 99.11%のバイトが異なる = 完全に別アルゴリズム
🎯 結論: アルゴリズム自体の逆エンジニアリングが必要
```

### フェーズ3: 逆エンジニアリング突破
```
🔬 決定分岐解析 → 第2決定で完全分岐発見
📊 Original: 18バイトマッチ選択
📊 我々: 直接ピクセル選択
💡 リングバッファ状態解釈の根本的差異判明

🎯 確定済みパラメータ:
   ✅ min_match_length = 3
   ✅ 3-4バイト長絶対優先
   ✅ 0-255距離範囲優先
   ✅ 99.9%マッチング選択率
```

### フェーズ4: 機械学習革命
```
🤖 画期的アプローチ: 522ファイル → 246万決定ポイント学習
🧠 PyTorch + CUDA: 447,685パラメータ、39次元特徴量
📈 75.3%決定精度達成

🎯 ML重要発見:
   🏆 compression_progress: 27.36 (最重要)
   🥈 estimated_y: 16.58 (第2位)
   
📊 範囲限定成功:
   ✅ length_3_weight: 90-120 (ML推定)
   ✅ length_4_weight: 80-110
   ✅ distance_threshold: 8-32
   ✅ match_threshold: 70-90
```

### フェーズ5: 限界発見と解決設計
```
⚠️ 重大発見: 75.3%精度 = 60万8千誤決定
💔 結果: 42-112ピクセル差異の直接原因
🎯 目標再定義: 圧縮 + diffs=0 同時達成必須

💡 PerfectOriginalReplication戦略設計:
   📋 95%確定的ルール (高信頼度パターン)
   🤖 5%ML強化 (残りの不確実性)
   🔄 リアルタイム検証ループ
   🎯 100%決定精度達成
```

---

## 🎯 最終戦略: 的を絞った総当たり検索

### 検索空間の劇的削減
```
🚫 従来: 無制限総当たり = 数百万組み合わせ
✅ 今回: 調査済み範囲限定 = 数千組み合わせ (1/1000)

📊 限定済みパラメータ:
   🔒 min_match_length: 3 (確定)
   📏 max_match_length: [8, 12, 16, 18] (4値)
   ⚖️ length_3_weight: [95, 100, 105, 110, 115] (5値)
   ⚖️ length_4_weight: [85, 90, 95, 100, 105] (5値)
   📐 distance_threshold: [16, 24, 32] (3値)
   🎚️ match_threshold: [75, 80, 85] (3値)
   🔄 position_mod: [100, 500, 1000] (3値)
   
🧮 合計: 4×5×5×3×3×3 = 2,700組み合わせ
⏱️ 予想時間: 約30分 (vs 従来の数週間)
```

### 段階的検索戦略
```
🥇 フェーズ1: 代表3ファイルで高速スクリーニング
🥈 フェーズ2: 候補パラメータを522ファイル全体で検証
🥉 フェーズ3: 完璧パラメータの教育用実装

🎯 成功判定基準:
   ✅ 全ファイルでピクセル差異 = 0
   ✅ 圧縮率 200-300% (オリジナル近似)
   ✅ 決定精度 100%
```

---

## 📚 教育的価値

### このプロジェクトの革新性
1. **暗号解読的アプローチ**: 失われたアルゴリズムの完全復元
2. **機械学習考古学**: AIによるレトロ技術の発掘
3. **段階的科学手法**: 仮説→実験→改良のサイクル
4. **教材としての完成度**: 逆エンジニアリング→ML→実装の完全フロー

### 応用可能性
- 他のレトロゲーム形式への応用
- 失われた圧縮技術の復元手法確立
- 機械学習による技術考古学の新分野創出

---

## 🚀 次回実行予定

```bash
# 的を絞った総当たり検索実行
cargo run --example targeted_parameter_search

# 夜間実行対応
nohup cargo run --example targeted_parameter_search > search_results.log 2>&1 &
```

**予想結果**: 30分以内に完璧なパラメータセット発見、20年前の開発者設定値完全復元達成

---

*「機械学習で失われたレトロゲーム技術を復活させる」*  
*〜 デジタル考古学の新時代 〜*